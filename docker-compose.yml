# Tele-Agent Docker Compose
# For local development and general Docker deployment
#
# Usage:
#   Development (build local):  docker compose up --build
#   Production (use GHCR):      docker compose up
#

version: "3.8"

services:
  tele-agent:
    # Option 1: Use pre-built image from GitHub Container Registry
    # image: ghcr.io/ognevoa/tele-agent:latest
    
    # Option 2: Build locally (default for development)
    build: .
    
    container_name: tele-agent
    restart: unless-stopped
    
    environment:
      # Required - set these in .env file!
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_ADMIN_ID=${TELEGRAM_ADMIN_ID}
      
      # LLM Providers (at least one required)
      - GEMINI_API_KEY=${GEMINI_API_KEY:-}
      - GEMINI_MODEL=${GEMINI_MODEL:-gemini-1.5-flash}
      
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - ANTHROPIC_MODEL=${ANTHROPIC_MODEL:-claude-3-haiku-20240307}
      
      # Default provider (gemini or anthropic)
      - DEFAULT_LLM_PROVIDER=${DEFAULT_LLM_PROVIDER:-gemini}
      
      # Personality files location
      - SOUL_FILE=/app/personality/SOUL.md
      - IDENTITY_FILE=/app/personality/IDENTITY.md
      - USER_FILE=/app/personality/USER.md
      - TOOLS_FILE=/app/personality/TOOLS.md
    
    volumes:
      # Persist data (ChromaDB, state)
      - tele-agent-data:/app/data
      
      # Mount personality files
      - ./personality:/app/personality:ro
      
      # Mount skills directory for live editing
      - ./skills:/app/skills:ro
      
      # Logs
      - ./logs:/app/logs

volumes:
  tele-agent-data:
    name: tele-agent-data
